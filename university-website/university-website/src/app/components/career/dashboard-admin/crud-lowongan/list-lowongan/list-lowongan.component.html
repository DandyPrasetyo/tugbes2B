<!-- html-validate-disable -->
<div class="card">
  <div class="header">
    <!-- baris 1: judul kiri, tombol kanan -->
    <div class="header-top">
      <h2>Data Lowongan</h2>

      <a routerLink="/career/admin/lowongan/add" class="btn-add">
        + Tambah Lowongan
      </a>
    </div>

    <!-- baris 2: filter tepat di bawah "Data Lowongan" -->
    <div class="toolbar">
      <!-- kapsul 1: Judul -->
      <div class="search-pill">
        <input
          type="text"
          class="filter-input"
          [(ngModel)]="judulFilter"
          placeholder="Masukkan judul lowongan..." />
      </div>

      <!-- kapsul 2: Posisi -->
      <div class="search-pill">
        <input
          type="text"
          class="filter-input"
          [(ngModel)]="posisiFilter"
          placeholder="Masukkan posisi..." />
      </div>

      <!-- kapsul 3: Tipe Pekerjaan -->
      <div class="search-pill">
        <select
          class="filter-select"
          [(ngModel)]="tipeFilter">
          <option value="">-- Pilih Tipe Pekerjaan --</option>
          <option value="Part_time">Part Time</option>
          <option value="Full_time">Full Time</option>
          <option value="Magang">Magang</option>
        </select>
      </div>

      <button class="btn-search" (click)="doSearch()">
        Search üîç
      </button>

      <button class="btn-reset" (click)="resetFilter()">
        Reset
      </button>

      <span class="search-count">
        Menampilkan {{ hasilCount }} hasil dari {{ totalLowongan }} lowongan
      </span>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th scope="col">No</th>
        <th scope="col">Judul Lowongan</th>
        <th scope="col">Posisi</th>
        <!-- KOLOM BARU LOKASI -->
        <th scope="col">Lokasi</th>
        <th scope="col">Deskripsi</th>
        <th scope="col">Poster</th>
        <th scope="col">Tipe Pekerjaan</th>
        <th scope="col">Gaji</th>
        <th scope="col">Tgl Post</th>
        <th scope="col">Deadline</th>
        <th scope="col">Status</th>
        <th scope="col">Aksi</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngIf="loading">
        <td colspan="12" class="loading">Memuat data...</td>
      </tr>

      <tr *ngFor="let row of filteredList ?? []; let i = index">
        <td>{{ i + 1 }}</td>

        <!-- highlight judul, posisi, deskripsi, tipe -->
        <td [innerHTML]="highlight(row?.judulLowongan || '')"></td>
        <td [innerHTML]="highlight(row?.posisi || '')"></td>

        <!-- LOKASI BARU -->
        <td [innerHTML]="highlight(row?.lokasi || '')"></td>

        <td
          class="max-w-xs truncate"
          [innerHTML]="highlight(row?.deskripsi || '')"
        ></td>

        <!-- Poster / flayer -->
        <td>
          <ng-container *ngIf="row?.flayer; else noPoster">
            <img
              [src]="'http://localhost:8080/' + row.flayer"
              alt="Poster"
              style="height: 60px; object-fit: cover"
            >
          </ng-container>
          <ng-template #noPoster>Belum ada poster</ng-template>
        </td>

        <td [innerHTML]="highlight(row?.tipePekerjaan || '')"></td>
        <td>{{ row?.gaji | currency:'IDR':'symbol':'1.0-0' }}</td>

        <!-- createdAt dari backend -->
        <td>{{ row?.createdAt | date:'dd/MM/yyyy' }}</td>

        <td>{{ row?.batasTanggal | date:'dd/MM/yyyy' }}</td>

        <td>
          <span
            class="badge"
            [class.active]="row?.status === 'Aktif'"
            [class.closed]="row?.status === 'Tutup'"
          >
            {{ row?.status }}
          </span>
        </td>

        <!-- Aksi -->
        <td>
          <div class="action-buttons">
            <a
              class="btn-edit"
              [routerLink]="['/career/admin/lowongan/edit', row?.lowonganId]"
            >
              Edit
            </a>
            <button
              class="btn-delete"
              (click)="deleteLowongan(row?.lowonganId)"
            >
              Hapus
            </button>
          </div>
        </td>
      </tr>

      <tr *ngIf="!loading && (filteredList?.length ?? 0) === 0">
        <td colspan="12" class="no-data">
          Tidak ada lowongan yang ditemukan.
        </td>
      </tr>
    </tbody>
  </table>
</div>
